<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tripartite Model 3: Fossilized Birth Death • Phylogenetic Paleobiology at GSA 2019</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Tripartite Model 3: Fossilized Birth Death">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">Phylogenetic Paleobiology at GSA 2019</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">9.21.2019</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a></a>
</li>
<li>
  <a></a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/organizers.html">Our Team</a>
</li>
<li>
  <a href="../../articles/code_conduct.html">Expected Conduct</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software &amp; Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/install_main.html">Required Software to Install</a>
    </li>
    <li>
      <a href="../../articles/downloads.html">Required Materials to Download</a>
    </li>
    <li>
      <a href="../../articles/readings.html">Recommended Readings</a>
    </li>
    <li>
      <a href="../../articles/install_extra.html">Extra Software</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule &amp; Lessons
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/schedule.html">Workshop Schedule</a>
    </li>
    <li>
      <a href="../../articles/module_02_meet_our_dataset_S&amp;Z2009/module_02.html">2 - Meet Our Dataset</a>
    </li>
    <li>
      <a href="../../articles/module_03_coding_from_scratch/module_3.html">3 - Coding Characters From Scratch</a>
    </li>
    <li>
      <a href="../../articles/module_04_Intro_RevBayes_Graphical_Modeling/module_04.html">4 - RevBayes &amp; Graphical Models</a>
    </li>
    <li>
      <a href="../../articles/module_05_TripartiteModel1_morph_change_models/05_RB_MCMC_Discrete_Morph.html">5 - Tripartite Model I - Discrete Morphology - Models and Tree Inference</a>
    </li>
    <li>
      <a href="../../articles/module_06_TripartiteModel2_clock_models/Clock_models_for_character_data.html">6 - Tripartite Model II - Clock Models of Character Change</a>
    </li>
    <li>
      <a href="../../articles/module_07_TripartiteModel3_Fossilized_Birth_death/module_07.html">7 - Tripartite Model III - Fossilized Birth Death Model</a>
    </li>
    <li>
      <a href="../../articles/module_08_worked_PCM_example/module_08.html">8 - Phylogenetic Comparative Methods</a>
    </li>
    <li>
      <a href="../../articles/symbols.html">Notation Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/dwbapst/PaleoSoc_phylo_short_course_2019">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tripartite Model 3: Fossilized Birth Death</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dwbapst/PaleoSoc_phylo_short_course_2019/blob/master/vignettes/module_07_TripartiteModel3_Fossilized_Birth_death/module_07.Rmd"><code>vignettes/module_07_TripartiteModel3_Fossilized_Birth_death/module_07.Rmd</code></a></small>
      <div class="hidden name"><code>module_07.Rmd</code></div>

    </div>

    
    
<div id="david-w--bapst-laura-soul" class="section level3">
<h3 class="hasAnchor">
<a href="#david-w--bapst-laura-soul" class="anchor"></a>David W. Bapst, Laura Soul</h3>
<div id="lecture-hands-on-with-revbayesrevnotebook" class="section level4">
<h4 class="hasAnchor">
<a href="#lecture-hands-on-with-revbayesrevnotebook" class="anchor"></a>Lecture &amp; Hands-On with RevBayes/RevNotebook</h4>
</div>
</div>
<div id="learning-objectives" class="section level1">
<h1 class="hasAnchor">
<a href="#learning-objectives" class="anchor"></a>Learning Objectives</h1>
<p>Students will learn to: - Describe a stochastic model of branching and extinction - Explain how allowing for serial sampling allows us to consider trees that encompass the fossil record -</p>
<p>MISSION If students come away with anything from my FBD lecture, it should be that FBD is a simple, but sensible model of diversification and sampling, which allows us to relate how well sampled a given fossil record is to inform how much evolutionary history we may have ultimately missed, and thus when clades may have diverged in the shadow before time.</p>
<div id="pure-birth-models" class="section level2">
<h2 class="hasAnchor">
<a href="#pure-birth-models" class="anchor"></a>Pure Birth Models</h2>
<p>Simulate under a pure-birth process and ask whose data looks like this?</p>
<p>Nee 2006</p>
</div>
<div id="birth-death-models" class="section level2">
<h2 class="hasAnchor">
<a href="#birth-death-models" class="anchor"></a>Birth-Death Models</h2>
<p>Simulate under a birth-death process and ask whose data looks like this?</p>
<div id="how-weve-used-birth-death-in-paleontology" class="section level3">
<h3 class="hasAnchor">
<a href="#how-weve-used-birth-death-in-paleontology" class="anchor"></a>How We’ve Used Birth-Death In Paleontology</h3>
<p>something something Foote, per-capita rates</p>
<p>As a note, I do plan on saying that lambda, mu and psi are often given the alternative notation of p/q/r in some paleontological studies – and then saying nothing more at all.</p>
<p>SEE NOTATION GUIDE - LINK</p>
</div>
<div id="birth-death-models-for-phylogenies" class="section level3">
<h3 class="hasAnchor">
<a href="#birth-death-models-for-phylogenies" class="anchor"></a>Birth-Death Models For Phylogenies</h3>
<div class="figure">
<img src="Reconstructing%20Phylogenies%20-%20Purvis%202008.jpeg" alt="The Reconstructed Phylogeny"><p class="caption">The Reconstructed Phylogeny</p>
</div>
<div class="figure">
<img src="lineage_ages_in_Nee_etal._1994.jpg" alt="How the Nee et al. birth-death model works."><p class="caption">How the Nee et al. birth-death model works.</p>
</div>
<p>/home/dwbapst/workspace/PaleoSoc_phylo_short_course_2019/vignettes/module_07_TripartiteModel3_Fossilized_Birth_death/lineage_ages_in_Nee_etal._1994.jpg</p>
</div>
</div>
<div id="fossilized-birth-death-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fossilized-birth-death-model" class="anchor"></a>Fossilized Birth-Death Model</h2>
<p>-Simulate under the FBD and show that this process allows sampled ancestors?</p>
<div id="serial-sampling" class="section level3">
<h3 class="hasAnchor">
<a href="#serial-sampling" class="anchor"></a>Serial Sampling</h3>
</div>
<div id="sampled-ancestors" class="section level3">
<h3 class="hasAnchor">
<a href="#sampled-ancestors" class="anchor"></a>Sampled Ancestors</h3>
</div>
<div id="fbd-ranges-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fbd-ranges-model" class="anchor"></a>FBD Ranges Model</h3>
<div class="figure">
<img src="tip-dating%20with%20ranges%20Stadler%20FBD%20paper%202017.jpg" alt="FBD Ranges Model (Stadler, 2017)"><p class="caption">FBD Ranges Model (Stadler, 2017)</p>
</div>
</div>
</div>
</div>
<div id="bringing-it-all-together" class="section level1">
<h1 class="hasAnchor">
<a href="#bringing-it-all-together" class="anchor"></a>Bringing It All Together</h1>
<div id="how-long-will-it-run" class="section level2">
<h2 class="hasAnchor">
<a href="#how-long-will-it-run" class="anchor"></a>How long will it run?</h2>
<p>A long time.</p>
</div>
<div id="post-analysis-examination" class="section level2">
<h2 class="hasAnchor">
<a href="#post-analysis-examination" class="anchor"></a>Post-Analysis Examination</h2>
<p>The MCMC is done. That was the easy part, now its the hard part.</p>
<p>Thinking about the output of Bayesian analyses isn’t easy…</p>
<p>Thinking about the output of Phylogenetic analyses isn’t easy…</p>
<p>Thankfully these two problems somewhat solve each other.</p>
<div id="did-it-converge" class="section level3">
<h3 class="hasAnchor">
<a href="#did-it-converge" class="anchor"></a>Did it converge?</h3>
<p>Tracer</p>
</div>
<div id="what-did-the-posterior-find" class="section level3">
<h3 class="hasAnchor">
<a href="#what-did-the-posterior-find" class="anchor"></a>What did the posterior find?</h3>
<p>More Tracer</p>
</div>
<div id="summarizing-the-trees" class="section level3">
<h3 class="hasAnchor">
<a href="#summarizing-the-trees" class="anchor"></a>Summarizing the tree(s)</h3>
<blockquote>
<p>A single tree is not worth the forest.</p>
</blockquote>
</div>
</div>
</div>
<div id="notes" class="section level1">
<h1 class="hasAnchor">
<a href="#notes" class="anchor"></a>NOTES</h1>
<pre><code>- Fossilized Birth Death Models 
    - Stadler, 2010; Heath et al., 2014; Stadler et al., 2018
    - FBD, Range-FBD
- Anc-Desc Relationships, Sampled Ancestors in Tip-Dating
    - Sampled Ancestor Moves in MCMC
    - Gavryushkina et al. 2014; 2016
- Try to simplify, do not get lost in covering historical perspective

- From Pete:
    - BD &amp; FBD (BDS) models for putting prior probabilities on tree topologies offer independent check on characters 
    - A. Emphasis: Probabilities getting fossil record given phylogeny based on likelihood of unsampled ancestors AND probability of no sampled sister taxa (aka, Raup’s Revenge).
    - B. Our old friend hyperpriors used to create distributions for these rates.
    - Z. 
    </code></pre>
<div id="section" class="section level26">
<p></p>
</div>
<div id="section-1" class="section level25">
<p></p>
<p>From Pete</p>
<p>By the way, here is the FBD parameterization I’ve been using for cinctan analyses. There is one big difference between this and the RevBayes standard: extinction does not vary independently of origination; instead, turnover is set up to range from 0.90X to 1.05X origination, and extinction is set to the turnover. (Given that the entire clade goes extinct over this interval, we might even just set mu=lambda….) However: I have left the “standard” code in there blocked out.</p>
<p>The estimate for rho is an empirical one based on all echinoderm occurrences from the last stage-slice in the Cambrian in which a cinctan occurs.</p>
<p>I think that I’ve brought this up before, but there seems to be a bug in RevBayes, too. If you use min &amp; max as they do, then the program seems to treat the last appearance as the earliest possible divergence time for OTUs rather than the first appearance. As a result, you get divergence dates for taxa that are after they first appear. Moreover, you sometimes wind up with positive log-priors in these cases. I’ll bet my eye-teeth that this is the program using the FA data in that case and coming up with a negative value for the branch duration, and then multiplying that negative by the log of the probability of zero finds or Cousin Matthews over that absolute amount of time.</p>
<p>This routine also separates out divergence times (node age) and origination times (when the lineage starts). The latter does not appear to be in the tree model anywhere. If you were to do lineage-through-time plots, then each observed species would get it’s origination time through it’s last appearance, and each unsampled ancestor (Norell’s “ghost taxa”) would get the origination time through the divergence time.</p>
<p>The other useful thing about that routine is that you see tau.nodeAge and tau.branchLength, which are useful for other things.</p>
<p>Finally, the FBD_p, FBD_q &amp; FBD_r are not used for anything in the analyses. I just use them for the onscreen output, as that is alphabetized; this way, you see the “classic” parameters in order as your computer grinds through cinctan trees &amp; rate models.</p>
<pre><code>########################################################################
# Set up appropriate parameters for speciation, extinction &amp; sampling  #
#   "Seed" numbers based on analyses of Paleobiology Database data.    #
########################################################################
# Diversification Rates based on Echinodermata
speciation_rate ~ dnExponential(1.471);
# NOTE: If it gets stuck in this script, then set origination &amp; extinction to 1.0
moves.append(mvScale(speciation_rate, lambda=0.01, weight=5));
moves.append(mvScale(speciation_rate, lambda=0.10, weight=3));
moves.append(mvScale(speciation_rate, lambda=1.00, weight=1));

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# NOTE: FBD scripts often allow extinction to vary independently of speciation;     #
# However, empirical studies show that these two rates usually are close to equal   #
#               and they definitely are not independent.                            #
# So, here we'll make turnover (ext/orig) an independent variable and use it        #
#               to scale extinction relative to origination                         #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
turnover ~ dnUnif(0.9, 1.05);
moves.append(mvSlide(turnover, delta=0.01, weight=5));
moves.append(mvSlide(turnover, delta=0.10, weight=3));
moves.append(mvSlide(turnover, delta=1.00, weight=1));
extinction_rate := turnover*speciation_rate;
diversification := speciation_rate - extinction_rate;

# old extinction stuff. We should not use this, as extinction should not be independent of origination!
#extinction_rate ~ dnExponential(1.471);
#moves.append(mvScale(extinction_rate, lambda=0.01, weight=5));
#moves.append(mvScale(extinction_rate, lambda=0.10, weight=3));
#moves.append(mvScale(extinction_rate, lambda=1.00, weight=1));
#turnover := extinction_rate/speciation_rate;

# Fossil Sampling Rates based on collection occupied by Echinodermata
psi ~ dnExponential(3.892);
completeness := psi/(extinction_rate+psi);
moves.append(mvScale(psi, lambda=0.01, weight=5));
moves.append(mvScale(psi, lambda=0.10, weight=3));
moves.append(mvScale(psi, lambda=1.00, weight=1));

# Proportional Taxon Sampling of Youngest Time Slice
rho &lt;- 0.506;   # 'extant' sampling.

# Establish Basal Divergence Time
origin_time ~ dnUnif(7.3, 12.11);
moves.append(mvSlide(origin_time, delta=0.01, weight=5));
moves.append(mvSlide(origin_time, delta=0.10, weight=3));
moves.append(mvSlide(origin_time, delta=1.00, weight=1));

fbd_dist = dnFBDRP(origin=origin_time, lambda=speciation_rate, mu=extinction_rate, psi=psi, rho=rho, taxa=taxa);

############################################################################
#                               Set up tree                                #
############################################################################
# create the vector of clade constraints
constraints = v(ingroup);
tau ~ dnConstrainedTopology(fbd_dist,constraints=constraints);

moves.append(mvFNPR(tau, weight=n_branches/2));                              # time-tree pruning &amp; grafting
moves.append(mvNNI(tau, weight=n_branches/2));                               # nearest-neighbor interchanges
moves.append(mvCollapseExpandFossilBranch(tau,origin_time,weight=n_taxa/4)); # consider ancestor-descendant rather than sister species
moves.append(mvNodeTimeSlideUniform(tau, weight=n_branches/2));              # adjust divergence times
moves.append(mvRootTimeSlideUniform(tau, origin_time, weight=5));            # adjust basal divergence time.

num_samp_anc := tau.numSampledAncestors();
for (bn in 1:n_branches)    {
    divergence_dates[bn]:=tau.nodeAge(bn)                   # this is when a hypothesized ancestor diverges or an OTU is first seen;
    branch_lengths[bn]:=tau.branchLength(bn);               # this is branch *duration* not expected change!
    origin_dates[bn]:=tau.branchLength(bn)+tau.nodeAge(bn); # this is when a lineage diverged from its ancestor
    }
summed_gaps := sum(branch_lengths);

clade_extant = clade("Sucocystis_acrofera");
age_extant := tmrca(tau, clade_extant); # There is no particularly good reason to keep this!

pruned_tau := fnPruneTree(tau, prune=v("Asturicystis_havliceki","Nelegerocystis_ivantzovi","Rozanovicystis_triangularis","Davidocinctus_pembrokensis"))
#### for easy printing on screen ####
fbd_p := speciation_rate;
fbd_q := extinction_rate;
fbd_r := psi;</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#david-w--bapst-laura-soul">David W. Bapst, Laura Soul</a><ul class="nav nav-pills nav-stacked">
<li><a href="#lecture-hands-on-with-revbayesrevnotebook">Lecture &amp; Hands-On with RevBayes/RevNotebook</a></li>
      </ul>
</li>
      <li>
<a href="#learning-objectives">Learning Objectives</a><ul class="nav nav-pills nav-stacked">
<li><a href="#pure-birth-models">Pure Birth Models</a></li>
      <li>
<a href="#birth-death-models">Birth-Death Models</a><ul class="nav nav-pills nav-stacked">
<li><a href="#how-weve-used-birth-death-in-paleontology">How We’ve Used Birth-Death In Paleontology</a></li>
      <li><a href="#birth-death-models-for-phylogenies">Birth-Death Models For Phylogenies</a></li>
      </ul>
</li>
      <li>
<a href="#fossilized-birth-death-model">Fossilized Birth-Death Model</a><ul class="nav nav-pills nav-stacked">
<li><a href="#serial-sampling">Serial Sampling</a></li>
      <li><a href="#sampled-ancestors">Sampled Ancestors</a></li>
      <li><a href="#fbd-ranges-model">FBD Ranges Model</a></li>
      </ul>
</li>
      </ul>
</li>
      <li>
<a href="#bringing-it-all-together">Bringing It All Together</a><ul class="nav nav-pills nav-stacked">
<li><a href="#how-long-will-it-run">How long will it run?</a></li>
      <li>
<a href="#post-analysis-examination">Post-Analysis Examination</a><ul class="nav nav-pills nav-stacked">
<li><a href="#did-it-converge">Did it converge?</a></li>
      <li><a href="#what-did-the-posterior-find">What did the posterior find?</a></li>
      <li><a href="#summarizing-the-trees">Summarizing the tree(s)</a></li>
      </ul>
</li>
      </ul>
</li>
      <li><a href="#notes">NOTES</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Bapst, April Wright, Sandra Carlson, Laura Soul, David Wright, Rachel Warnock, Peter Wagner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
